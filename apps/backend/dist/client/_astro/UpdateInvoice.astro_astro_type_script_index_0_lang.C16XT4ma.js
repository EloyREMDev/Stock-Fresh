import{B as E}from"./endpoints.QH1VciTq.js";const n=document.getElementById("invoice-select"),d=document.getElementById("phone-number-input"),u=document.getElementById("invoice-status"),s=document.getElementById("submit-btn"),h={loadInvoices:async()=>{const o=`${E}/api/invoice`;console.log(`[REQUEST GET] Obteniendo facturas de: ${o}`);try{const e=await fetch(o);if(!e.ok)throw new Error(`Error HTTP ${e.status}: Error al obtener las facturas`);return e.json()}catch(e){throw console.error("Error en la solicitud GET:",e),e}},updateInvoice:async(o,e)=>{const t=`${E}/api/invoice/${o}`;try{console.log(`[REQUEST PUT] Enviando a: ${t}`),console.log("[REQUEST PUT] Datos del Body:",e);const a=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let r=`Error HTTP: ${a.status} al actualizar.`;try{r=(await a.json()).message||r}catch{}throw new Error(r)}return a.json()}catch(a){throw console.error("Error en la solicitud PUT:",a),a}}},y=()=>{n.innerHTML='<option value="">Cargando facturas...</option>',h.loadInvoices().then(o=>{n.innerHTML='<option value="">Seleccione Factura</option>',o.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=`${e.client_name} (ID: ${e.id})`,t.setAttribute("data-client-name",e.client_name),n.appendChild(t)})}).catch(o=>{console.error("Error al cargar las facturas:",o),n.innerHTML='<option value="">Error al cargar las facturas</option>'})};window.onload=function(){y()};document.addEventListener("DOMContentLoaded",()=>{const o=document.querySelector("#invoice-product-form"),e=document.querySelector("#status-message");let t=!1,a=!1,r=!0;const m=/^\d{11}$/,v=(c,l,f)=>{const i=document.querySelector(f);c.value===""?(c.classList.remove("input-invalid","input-valid"),i&&i.classList.add("hidden")):l?(c.classList.add("input-valid"),c.classList.remove("input-invalid"),i&&i.classList.add("hidden")):(c.classList.add("input-invalid"),c.classList.remove("input-valid"),i&&i.classList.remove("hidden"))},p=()=>{t&&a&&r?(s.disabled=!1,s.classList.remove("disabled:opacity-50")):(s.disabled=!0,s.classList.add("disabled:opacity-50"))};n.addEventListener("change",()=>{t=n.value!=="",v(n,t,".helper-text-invoice"),p()}),d.addEventListener("input",()=>{a=d.value!==""&&m.test(d.value),v(d,a,".helper-text-phone"),p()}),u.addEventListener("change",()=>{r=u.value!=="",v(u,r,".helper-text-status"),p()}),o.addEventListener("submit",async c=>{if(c.preventDefault(),t=n.value!=="",a=d.value!==""&&m.test(d.value),r=u.value!=="",!t||!a||!r){e.textContent="Por favor, completa todos los campos requeridos.",e.className="mt-4 text-center text-sm font-medium text-red-600";return}try{s.textContent="Actualizando...",s.disabled=!0;const l=parseInt(n.value),i=n.options[n.selectedIndex].getAttribute("data-client-name"),x={client_name:i,client_phone_number:d.value,status:u.value};await h.updateInvoice(l,x),s.textContent="Actualizar Factura",s.disabled=!1,e.textContent=`Factura ID ${l} de ${i} actualizada con Ã©xito.`,e.className="mt-4 text-center text-sm font-medium text-green-600"}catch(l){s.textContent="Actualizar Factura",s.disabled=!1,e.textContent=`Error al actualizar: ${l.message}`,e.className="mt-4 text-center text-sm font-medium text-red-600",console.error("Error al actualizar la factura:",l)}finally{p()}})});
