import{c as u}from"./notificiation.DyHDLNjw.js";import{B as m}from"./endpoints.QH1VciTq.js";import{k as y}from"./index.B9b1t7QR.js";import{a as P}from"./index.CViUNx8d.js";const E=`${m}/api/invoiceProducts`;let L=[];const v=P(L),h=async e=>{if(console.log(e),e.response){const t=await e.response.json();u({title:"Ups! Hubo un error",description:t.error,type:"error"})}else u({title:"Ups! Hubo un error",description:"No se pudo conectar con el servidor. Por favor, revisa tu conexión.",type:"error"})},w=async e=>{try{const t=await y.post(E,{json:e,credentials:"include"}).json();v.set(v.get().concat(t)),u({title:"Producto agregado a factura!",type:"success"})}catch(t){if(t.name==="HTTPError"&&t.response.status>=400){const o=await t.response.json();u({title:"Ups! Hubo un error",description:o.error,type:"error"})}else u({title:"Producto agregado a factura!",description:"El producto se agrego a la factura con éxito, pero la conexión se perdió. Recarga la página para verlo.",type:"success"}),console.log("Error de conexión inesperado, pero el producto se agrego con éxito:",t)}},x=async e=>{const t=`${E}/${e}`;try{const o=await y.delete(t,{credentials:"include"}).json();v.set(v.get().filter(s=>s.id!==o.id)),u({title:"Producto eliminado de la factura",description:`${productDeleted.name}`,type:"success"})}catch(o){h(o)}},I=async e=>{const t=`${E}/${e.id}`;try{const o=await y.put(t,{json:e,credentials:"include"}).json();v.set(v.get().map(s=>s.id===o.id?o:s)),u({title:"Producto actualizado",description:`${o.name}`,type:"success"})}catch(o){h(o)}},b=async()=>{try{const e=await fetch(`${m}/api/invoiceProducts`);if(!e.ok)throw new Error("Error al obtener los productos de la factura");return await e.json()}catch(e){return console.error("Error en getInvoiceProducts:",e),[]}},$=P(0),j=async()=>{try{const e=`${m}/api/dolar/rate`,t=await y.get(e).json();console.log("Respuesta de la API del dólar:",t),$.set(t.promedio)}catch(e){h(e)}},S={addInvoiceProduct:w,removeInvoiceProduct:x,updateInvoiceProduct:I,getInvoiceProducts:b,getDolarRate:j},a=document.getElementById("product-select"),n=document.getElementById("invoice-select"),N=()=>{fetch(`${m}/api/products`).then(e=>{if(!e.ok)throw new Error("Error al obtener los productos");return e.json()}).then(e=>{a.innerHTML='<option value="">Selecciona un producto</option>',e.forEach(t=>{const o=document.createElement("option");o.value=t.id,o.textContent=t.name,a.appendChild(o)})}).catch(e=>{console.error("Error al cargar los productos:",e),a.innerHTML='<option value="">Error al cargar los productos</option>'})},C=()=>{fetch(`${m}/api/invoice`).then(e=>{if(!e.ok)throw new Error("Error al obtener las facturas");return e.json()}).then(e=>{n.innerHTML='<option value="">Seleccione su nombre</option>',e.forEach(t=>{const o=document.createElement("option");o.value=t.id,o.textContent=t.client_name,n.appendChild(o)})}).catch(e=>{console.error("Error al cargar los productos:",e),n.innerHTML='<option value="">Error al cargar las facturas</option>'})};window.onload=function(){N(),C()};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#quantity"),t=document.querySelector("#invoice-product-form"),o=document.querySelector("#submit-btn"),s=document.querySelector("#status-message");let i=!1,d=!1,l=!1;const p=(r,g)=>{const c=r.parentElement.nextElementSibling;r.value===""?(r.classList.remove("input-invalid","input-valid"),c?.classList.add("hidden")):g?(r.classList.add("input-valid"),r.classList.remove("input-invalid"),c?.classList.add("hidden")):(r.classList.add("input-invalid"),r.classList.remove("input-valid"),c?.classList.remove("hidden"))},f=()=>{i&&d&&l?o.disabled=!1:o.disabled=!0};n.addEventListener("change",()=>{i=n.value!=="",p(n,i),f()}),a.addEventListener("change",()=>{d=a.value!=="",p(a,d),f()}),e.addEventListener("input",()=>{const r=parseInt(e.value);l=!isNaN(r)&&r>=0,p(e,l),f()}),t.addEventListener("submit",async r=>{r.preventDefault(),i=n.value!=="",d=a.value!=="";const g=parseInt(e.value);if(l=!isNaN(g)&&g>=0,!i||!d||!l){p(n,i),p(a,d),p(e,l);return}try{await S.addInvoiceProduct({invoice_id:parseInt(n.value),product_id:parseInt(a.value),quantity:parseInt(e.value)}),console.log("Éxito en el envío (revisa tu módulo para capturar el 400)",{}),s.textContent="Producto agregado con éxito.",s.className="mt-4 text-center text-sm font-medium text-green-600",t.reset(),i=!1,d=!1,l=!1,[n,a,e].forEach(c=>c.classList.remove("input-valid","input-invalid"))}catch(c){s.textContent=`Error al guardar producto: ${c.message}`,s.className="mt-4 text-center text-sm font-medium text-red-600",console.error("Error al agregar el producto:",c)}f()})});
