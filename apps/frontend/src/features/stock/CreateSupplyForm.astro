<div>
    <h2 class="text-3xl font-bold tracking-tight text-center sm:text-left text-[var(--button-color)]">Registrar Nuevo Insumo</h2>
    <p class="mt-2 text-center sm:text-left text-sm text-[var(--text-secondary)]">Complete el formulario para agregar un nuevo insumo al inventario.</p>
    
    <form id="supply-form" class="bg-white p-6 sm:p-8 rounded-lg shadow-sm mt-6 space-y-6">
        
        <div class="space-y-2">
            <label class="text-sm font-medium leading-none" for="supply-name">Nombre del Insumo</label>
            <div class="relative">
                <input id="supply-name" name="name" placeholder="Ej. Esencia de Lavanda" type="text" class="form-input flex w-full h-12 rounded-md border border-[var(--border-color)] bg-transparent px-4 py-2 text-sm placeholder:text-[var(--text-secondary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--button-color)]"/>
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center hidden icon-container"></div>
            </div>
            <p class="text-xs text-red-500 hidden helper-text">El nombre es requerido.</p>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div class="space-y-2">
                <label class="text-sm font-medium leading-none" for="quantity">Cantidad (En Litro)</label>
                <div class="relative">
                    <input id="quantity" name="quantity" placeholder="100" type="number" class="form-input flex w-full h-12 rounded-md border border-[var(--border-color)] bg-transparent px-4 py-2 text-sm placeholder:text-[var(--text-secondary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--button-color)]"/>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center hidden icon-container"></div>
                </div>
                <p class="text-xs text-red-500 hidden helper-text">La cantidad debe ser un número entero.</p>
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium leading-none" for="min-stock">Stock Mínimo</label>
                <div class="relative">
                    <input id="min-stock" name="minimum-stock" placeholder="20" type="number" class="form-input flex w-full h-12 rounded-md border border-[var(--border-color)] bg-transparent px-4 py-2 text-sm placeholder:text-[var(--text-secondary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--button-color)]"/>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center hidden icon-container"></div>
                </div>
                <p class="text-xs text-red-500 hidden helper-text">El stock mínimo debe ser un número entero.</p>
            </div>
        </div>
        
        <div class="space-y-2">
            <label class="text-sm font-medium leading-none" for="supplier">Proveedor</label>
            <div class="relative">
                <input id="supplier" name="supplier" placeholder="Ej. P&G" type="text" class="form-input flex w-full h-12 rounded-md border border-[var(--border-color)] bg-transparent px-4 py-2 text-sm placeholder:text-[var(--text-secondary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--button-color)]"/>
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center hidden icon-container"></div>
            </div>
            <p class="text-xs text-red-500 hidden helper-text">El fabricante es requerido.</p>
        </div>

        <p id="status-message" class="text-center"></p>
        
        <div class="flex justify-end gap-4">
            <button class="flex items-center justify-center rounded-md text-sm font-medium transition-colors h-10 px-4 py-2 bg-[var(--secondary-color)] hover:bg-[var(--border-color)] text-[var(--text-primary)]">Cancelar</button>
            <button id="submit-btn" class="flex items-center justify-center rounded-md text-sm font-medium transition-colors h-10 px-4 py-2 bg-[var(--button-color)] hover:bg-[var(--primary-color)] text-white" type="submit" disabled>Registrar Insumo</button>
        </div>
    </form>
</div>

<script>
// @ts-nocheck
// Modulos
import SupplyModule from "./supply.module.js";

// Selectores
const inputName = document.querySelector('#supply-name');
const inputQuantity = document.querySelector('#quantity');
const inputMinimumStock = document.querySelector('#min-stock');
const inputSupplier = document.querySelector('#supplier');
const form = document.querySelector('#supply-form');
const submitBtn = document.querySelector('#submit-btn');
const statusMessage = document.querySelector('#status-message'); // Asegúrate de que este elemento exista en tu HTML

// Validaciones del formulario
let nameValidation = false;
let quantityValidation = false;
let minimumStockValidation = false;
let supplierValidation = false;

// Funciones
const renderValidation = (input, validation) => {
  const helperText = input.parentElement.nextElementSibling;
  const iconContainer = input.nextElementSibling;
  
  if (input.value === '') {
    input.classList.remove('input-invalid', 'input-valid');
    helperText?.classList.add('hidden');
    iconContainer.innerHTML = '';
    iconContainer.classList.add('hidden');
  } else if (validation) {
    input.classList.add('input-valid');
    input.classList.remove('input-invalid');
    helperText?.classList.add('hidden');
    iconContainer.innerHTML = '<span class="iconify" data-icon="mdi:check-circle" style="color: green;"></span>';
    iconContainer.classList.remove('hidden');
  } else {
    input.classList.add('input-invalid');
    input.classList.remove('input-valid');
    helperText?.classList.remove('hidden');
    iconContainer.innerHTML = '<span class="iconify" data-icon="mdi:close-circle" style="color: red;"></span>';
    iconContainer.classList.remove('hidden');
  }
};

const renderButtonState = () => {
  if (nameValidation && quantityValidation && minimumStockValidation && supplierValidation) {
    submitBtn.disabled = false;
  } else {
    submitBtn.disabled = true;
  }
};

// Eventos
inputName.addEventListener('input', () => {
  nameValidation = inputName.value.trim().length > 0;
  renderValidation(inputName, nameValidation);
  renderButtonState();
});

inputQuantity.addEventListener('input', () => {
  const value = parseInt(inputQuantity.value);
  quantityValidation = !isNaN(value) && value >= 0;
  renderValidation(inputQuantity, quantityValidation);
  renderButtonState();
});

inputMinimumStock.addEventListener('input', () => {
  const value = parseInt(inputMinimumStock.value);
  minimumStockValidation = !isNaN(value) && value >= 0;
  renderValidation(inputMinimumStock, minimumStockValidation);
  renderButtonState();
});

inputSupplier.addEventListener('input', () => {
  supplierValidation = inputSupplier.value.trim().length > 0;
  renderValidation(inputSupplier, supplierValidation);
  renderButtonState();
});

form.addEventListener('submit', async e => {
  e.preventDefault();

  // 1. Validar todos los campos
  if (!nameValidation || !quantityValidation || !minimumStockValidation || !supplierValidation) {
    renderValidation(inputName, nameValidation);
    renderValidation(inputQuantity, quantityValidation);
    renderValidation(inputMinimumStock, minimumStockValidation);
    renderValidation(inputSupplier, supplierValidation);
    return;
  }
  
  // 3. Agregar el insumo con la URL de la imagen
  try {
    await SupplyModule.addSupply({
      name: inputName.value.trim(),
      supplier: inputSupplier.value.trim(),
      quantity: parseInt(inputQuantity.value),
      minimum_stock: parseInt(inputMinimumStock.value),
    });

    statusMessage.textContent = 'Insumo guardado con éxito.';
    statusMessage.className = 'mt-4 text-center text-sm font-medium text-green-600';
  } catch (error) {
    statusMessage.textContent = `Error al guardar insumo: ${error.message}`;
    statusMessage.className = 'mt-4 text-center text-sm font-medium text-red-600';
    console.error('Error al guardar el insumo:', error);
  }

  // 4. Limpiar el formulario
  form.reset();
  renderButtonState();
});
</script>
